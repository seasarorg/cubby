<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title id="title">Cubby - Mayaaとの連携</title>
<link href="style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="container">
<div id="header"></div>
<div id="navigation"></div>
<div id="content">
<a name="controller"></a>
<h2>Mayaaとの連携</h2>
<p>
Cubbyでデザイナーが作成したHTMLをテンプレートとしてビューを作成したい場合、Javaテンプレートエンジンである<a href="http://mayaa.seasar.org/index.html">Mayaa</a>と連携することができます。
<br/>
<br/>
<a href="http://mayaa.seasar.org/index.html">Mayaaの公式サイト</a>
<br/>
<br/>
以下、Mayaaとの連携方法を示します。動作はCubby0.9.0、Mayaa-1.1.14で確認しています。<br/>
また、CubbyのサンプルWarに「Mayaaとの連携のサンプル」がありますのでそちらも参照ください。
</p>
<a name="view"></a>
<h2>Mayaaとの連携設定</h2>
<h3>1.Mayaaの依存JARファイルを追加する</h3>
<p>
Mayaaの依存JARファイルを全て追加します。Maven2を使用している場合は依存にMayaaを追加するだけでOKです。
</p>
<h3>2.web.xmlへMayaaサーブレットを追加する</h3>
<p>
Mayaaサーブレットをservletとservlet-mappingとして追加します。
</p>
<pre class="code">
...
  &lt;servlet&gt;
    &lt;servlet-name&gt;MayaaServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.seasar.mayaa.impl.MayaaServlet&lt;/servlet-class&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
  &lt;/servlet&gt;
...
  &lt;servlet-mapping&gt;
    &lt;servlet-name&gt;MayaaServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;*.html&lt;/url-pattern&gt;
  &lt;/servlet-mapping&gt;
...
</pre>
<h3>3.アクションメソッドのフォワード先を「*.html」にします。</h3>
<p>
アクションクラスはJSPの時と作り方は変わりません。
アクションメソッドのフォワード先を「*.html」にしてビューがMayaaで実行されるようにします。
</p>
<strong>org.seasar.cubby.examples.other.web.components.MayaaComponentsAction.java</strong>
<pre class="code">
public class MayaaComponentsAction extends Action {
...
  @Override
  public void prerender() {
    super.prerender();
    hobbies = getHobbies();
    colors = getColors();
  }
  @Form("form")
  public ActionResult components() {
    return new Forward("components.html");
  }
...
}
</pre>
<h3>4.HTMLテンプレートとMayaaファイルを作成します。</h3>
<p>
HTMLテンプレートとMayaaファイルを作成します。
これはMayaaのルールで作成します。
CubbyのカスタムタグをMayaaファイルに記述することで、Cubbyの機能をMayaaから利用できます。
</p>
<h4>CubbyとMayaaの使い分け</h4>
<p>
CubbyとMayaaの機能が一部重複しています。
レイアウト共有やコンポーネント(HTML 部品)、Rhino(JavaScript)による強力なスクリプト機能は
Mayaaのほうが優れているので、そのまま使用することをおすすめします。<br/>
例えば下記の例では、テーブルの行毎の色づけ（odd/even）をMayaaのforEachプロセッサとRhinoで実現しています。<br/>
Cubbyのカスタムタグは主に入力フォームの生成に使用します。
</p>
<strong>mayaa/components.html</strong>
<pre class="code">
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja"&gt;
&lt;head&gt;
  &lt;title&gt;components.html&lt;/title&gt;
  &lt;link href="./../css/default.css" rel="stylesheet" type="text/css" media="screen,projection" charset="utf-8" /&gt;
&lt;/head&gt;
&lt;body&gt;
[&lt;a href="./../"&gt;戻る&lt;/a&gt;]
&lt;form id="form" method="post" action="./components"&gt;
&lt;h1&gt;コンポーネント一覧&lt;/h1&gt;
&lt;h2&gt;Input Text&lt;/h2&gt;
&lt;label for="userName"&gt;Name:&lt;/label&gt;&lt;input id="userName" type="text" name="userName"/&gt;

&lt;h2&gt;Select&lt;/h2&gt;
&lt;label for="color"&gt;Color:&lt;/label&gt;
&lt;select id="color" name="color" size="3"&gt;
  &lt;option value="red"&gt;赤&lt;/option&gt;
  &lt;option value="blue"&gt;青&lt;/option&gt;
  &lt;option value="yellow" selected="selected"&gt;黄色&lt;/option&gt;
&lt;/select&gt;

&lt;h2&gt;TextArea&lt;/h2&gt; 
&lt;label for="memo"&gt;memo:&lt;/label&gt;&lt;br/&gt;
&lt;textarea id="memo" name="memo" rows="5" cols="50"&gt;&lt;/textarea&gt;

&lt;h2&gt;Checkbox&lt;/h2&gt; 
&lt;label for="check1"&gt;Check1:&lt;/label&gt;&lt;br/&gt;
&lt;input id="check1" type="checkbox" name="check1" value="true"/&gt;

&lt;h2&gt;Checkbox(Array)&lt;/h2&gt; 
&lt;label for="check2"&gt;Check2:&lt;/label&gt;&lt;br/&gt;
&lt;input id="check2-1" type="checkbox" name="check2" value="1"/&gt;
&lt;input id="check2-2" type="checkbox" name="check2" value="2"/&gt;
&lt;input id="check2-3" type="checkbox" name="check2" value="3"/&gt;

&lt;h2&gt;Odd & Null&lt;/h2&gt;
&lt;table border="1"&gt;
  &lt;tr&gt;
    &lt;th&gt;ID&lt;/th&gt;
    &lt;th&gt;LABEL&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr id="loop"&gt;
    &lt;td&gt;&lt;span id="item-value"&gt;&lt;/span&gt;&lt;/td&gt;
    &lt;td&gt;&lt;span id="item-name"&gt;&lt;/span&gt;&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr id="dummy"&gt;
    &lt;td&gt;dummy1&lt;/td&gt;
    &lt;td&gt;dummy1 name&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr id="dummy"&gt;
    &lt;td&gt;dummy2&lt;/td&gt;
    &lt;td&gt;dummy2 name&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;
&lt;br/&gt;
&lt;input type="submit" value="登録"/&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
<strong>mayaa/components.mayaa</strong>
<pre class="code">
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;m:mayaa xmlns:m="http://mayaa.seasar.org"
  xmlns:t="http://www.seasar.org/cubby/tags"
  xmlns:c="http://java.sun.com/jsp/jstl/core"&gt;

  &lt;!-- form --&gt;
  &lt;t:form m:id="form" method="post" action="${contextPath}/mayaa/components" value="${form}" /&gt;

  &lt;!-- text --&gt;
  &lt;t:input m:id="userName" type="text" name="userName" id="userName" /&gt;

  &lt;!-- select --&gt;
  &lt;t:select m:id="color" name="color" size="3" 
    items="${colors}" labelProperty="name" valueProperty="value" /&gt;
  &lt;!-- textarea --&gt;
  &lt;t:textarea m:id="memo" name="memo" rows="5" cols="50" /&gt;

  &lt;!-- checkbox(multi) --&gt;
  &lt;t:input m:id="check1" type="checkbox" name="check1" value="true" /&gt;

  &lt;!-- checkbox(single) --&gt;
  &lt;t:input m:id="check2-1" type="checkbox" name="check2" value="1" /&gt;
  &lt;t:input m:id="check2-2" type="checkbox" name="check2" value="2" /&gt;
  &lt;t:input m:id="check2-3" type="checkbox" name="check2" value="3" /&gt;
	
  &lt;!-- forEach and odd,even --&gt;
  &lt;m:forEach m:id="loop" var="item" index="s" items="${colors}" replace="false"&gt;
  &lt;m:attribute name="class" value="${"$"}{s % 2 ? 'odd' : 'even'}" /&gt;
  &lt;/m:forEach&gt;
  &lt;m:write m:id="item-value" value="${"$"}{item.value}" /&gt;
  &lt;m:write m:id="item-name" value="${"$"}{item.name}" /&gt;

  &lt;!-- remove dummy --&gt;
  &lt;m:null m:id="dummy" /&gt;
&lt;/m:mayaa&gt;
</pre>
<div id="footer"></div>
</div>
</body>
</html>

