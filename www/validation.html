<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">










<html>
  <head>
    <title>Cubby - バリデーション</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
          <meta name="author" content="agata" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      </head>
  <body class="composite">
    <div id="banner">
                  <a href="index.html" id="bannerLeft">
    
            Cubby
    
            </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
  

  
    
  
  
            <div class="xleft">
        最終更新: 10/01/2007
                      </div>
            <div class="xright">      <a href="http://www.seasar.org/">seasar.org</a>
          
  

  
    
  
  
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
  

  
    
  
  
                   <h5>ドキュメント</h5>
        <ul>
              
    <li class="none">
              <a href="index.html">Cubbyについて</a>
        </li>
              
    <li class="none">
              <a href="setup.html">セットアップ</a>
        </li>
              
    <li class="none">
              <a href="twominute.html">2分間チュートリアル</a>
        </li>
              
    <li class="none">
              <a href="fiveminute.html">5分間チュートリアル</a>
        </li>
              
    <li class="none">
              <a href="download.html">ダウンロード</a>
        </li>
          </ul>
          <h5>リファレンス</h5>
        <ul>
              
    <li class="none">
              <a href="action.html">アクション</a>
        </li>
              
    <li class="none">
              <strong>バリデーション</strong>
        </li>
              
    <li class="none">
              <a href="jsp.html">JSP</a>
        </li>
              
    <li class="none">
              <a href="tags.html">カスタムタグ</a>
        </li>
              
    <li class="none">
              <a href="functions.html">ファンクション</a>
        </li>
              
    <li class="none">
              <a href="messages.html">メッセージリソース</a>
        </li>
              
    <li class="none">
              <a href="mayaa.html">Cubby&Mayaa</a>
        </li>
          </ul>
          <h5>プロジェクト文書</h5>
        <ul>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
              <a href="project-info.html">プロジェクト情報</a>
              </li>
              
                
              
      
            
      
            
      
              
        <li class="collapsed">
              <a href="project-reports.html">プロジェクトレポート</a>
              </li>
          </ul>
          <h5>モジュール</h5>
        <ul>
              
    <li class="none">
              <a href="cubby/index.html">cubby</a>
        </li>
              
    <li class="none">
              <a href="cubby-archetype/index.html">cubby-archetype</a>
        </li>
              
    <li class="none">
              <a href="cubby-tomcat55-support/index.html">cubby-tomcat55-support</a>
        </li>
              
    <li class="none">
              <a href="cubby-skin/index.html">cubby-skin</a>
        </li>
              
    <li class="none">
              <a href="index.html">Cubby Distribution</a>
        </li>
          </ul>
                                       <a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy">
            <img alt="Built by Maven" src="./images/logos/maven-feather.png"></img>
          </a>
                       
  

  
    
  
  
        </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>バリデーション</h2><p>Cubby ではプログラム中に入力検証のルールを記述します。</p><p>それぞれのアクションメソッドで使用する入力検証ルールは、<a href="cubby/apidocs/org/seasar/cubby/action/Validation.html">@Validation</a>アノテーションで指定します。 検証エラーメッセージはActionの<a href="cubby/apidocs/org/seasar/cubby/action/Action.html#errors">errors</a>フィールドにセットされます。 検証エラー発生時は、errorPageで指定されたページに遷移します。 検証ルールのフィールドはデフォルトで「VALIDATION」が使用されます。別のフィールドに定義されたルールを使用する場合、rulesFieldにフィールド名を指定します。</p><p>また、Cubbyにクライアントサイドバリデーションはありません。</p><div class="source"><pre>  // 検証ルールのフィールドとしてデフォルトの「VALIDATION」が使用されます。
  // 検証エラー発生時は「confirm.jsp」に遷移します。
  @Form
  @Validation(errorPage = &quot;confirm.jsp&quot;)
  public ActionResult save1() {
    ... 
  }

  // 検証ルールのフィールドとして「validation2」が使用されます。
  // 検証エラー発生時は「confirm.jsp」に遷移します。
  @Validation(rulesField=&quot;validation2&quot;, errorPage = &quot;confirm.jsp&quot;)
  public ActionResult save2() {
    ... 
  }</pre></div><p>バリデーションの定義はJavaコードで記述します。以下のように<a href="cubby/apidocs/org/seasar/cubby/validator/DefaultValidationRules.html">DefaultValidationRule</a>を継承して、 <a href="cubby/apidocs/org/seasar/cubby/validator/DefaultValidationRules.html#initialize()">initialize</a>メソッド内で <a href="cubby/apidocs/org/seasar/cubby/validator/DefaultValidationRules.html#add(java.lang.String,%20org.seasar.cubby.validator.Validator...))">add</a>メソッドで フィールドごとにバリデーションのルールを追加します。</p><div class="source"><pre>public class LoginAction extends Action {
  public static ValidationRules VALIDATION = new DefaultValidationRule() {
    public void initialize() {
      add(&quot;userId&quot;, new RequiredValidator(), MaxLengthValidator(10));
      add(&quot;password&quot;, new RequiredValidator(), MaxLengthValidator(10));
    }
  };
  ...
}</pre></div><div class="section"><h3>バリデーションのエラーメッセージ</h3><p>バリデーションのエラーメッセージは以下のルールで作成されます。</p><ul><li>メッセージキーを指定しない場合、パラメータ名がエラーメッセージ中の項目名のメッセージキーとして使用されます。</li><li>メッセージキーを指定する場合、指定されたメッセージキーがエラーメッセージ中の項目名のメッセージキーとして使用されます。</li><li>DefaultValidationRuleのコンストラクタでキーの項目名のメッセージキーのプリフィックスを指定することができます。</li><li>各バリデーションのコンストラクタでメッセージキーを指定することで検証時のエラーメッセージを切り替えることもできます。<div class="source"><pre>public class LoginAction extends Action {

  // 項目のメッセージキーを指定
  public static ValidationRules VALIDATION = new DefaultValidationRule() {
    public void initialize() {
      // メッセージキー&quot;userId&quot;の値がエラーメッセージ中の項目名として使用されます。
      add(&quot;userId&quot;, new RequiredValidator(), MaxLengthValidator(10));
      // メッセージキー&quot;login.password&quot;の値がエラーメッセージ中の項目名として使用されます。
      add(&quot;password&quot;, &quot;login.password&quot;, new RequiredValidator(), MaxLengthValidator(10));
    }
  };

  // 項目名のメッセージキーのプリフィックスを指定
  public static ValidationRules VALIDATION2 = new DefaultValidationRule(&quot;login.&quot;) {
    public void initialize() {
      // メッセージキー&quot;login.userId&quot;の値がエラーメッセージ中の項目名として使用されます。
      add(&quot;userId&quot;, new RequiredValidator(), MaxLengthValidator(10));
    }
  };

  // 各バリデーションにメッセージキーを指定
  public static ValidationRules VALIDATION2 = new DefaultValidationRule() {
    public void initialize() {
      // メッセージキー&quot;err.myrequired&quot;がエラーメッセージとして使用されます。
      add(&quot;password&quot;, new RequiredValidator(&quot;err.myrequired&quot;));
    }
  };

  ...
}</pre></div></li></ul></div><div class="section"><h3>バリデーションルールのコピー</h3><p>ほとんどが同じでいくつかの項目が異なる複数のルールを作りたい場合、以下のように他のルールをコピーして使用することができます。</p><div class="source"><pre>public class LoginAction extends Action {

  // ベースのルール
  public static ValidationRules BASE_VALIDATION = new DefaultValidationRule() {
    public void initialize() {
      add(&quot;userId&quot;, new RequiredValidator(), MaxLengthValidator(10));
      add(&quot;password&quot;, &quot;login.password&quot;, new RequiredValidator(), MaxLengthValidator(10));
    }
  };

  // ベースのルールに「nickname」の検証を追加
  public static ValidationRules VALIDATION1 = new DefaultValidationRule() {
    public void initialize() {
      // BASE_VALIDATIONのルールをコピーして追加
      getRules().addAll(BASE_VALIDATION.getRules());
      add(&quot;nickname&quot;, new RequiredValidator(), MaxLengthValidator(10));
    }
  };

  // ベースのルールに「password2」の検証を追加
  public static ValidationRules VALIDATION2 = new DefaultValidationRule() {
    public void initialize() {
      // BASE_VALIDATIONのルールをコピーして追加
      getRules().addAll(BASE_VALIDATION.getRules());
      add(&quot;password2&quot;, new RequiredValidator(), MaxLengthValidator(10));
    }
  };
  ...
}</pre></div></div></div><div class="section"><h2>独自バリデーションの定義</h2><p>独自のバリデーションは<a href="cubby/apidocs/org/seasar/cubby/validator/Validator.html">Validator</a>を実装して作成します。 通常は<a href="cubby/apidocs/org/seasar/cubby/validator/BaseValidator.html">BaseValidator</a>を継承して作成します。</p><div class="source"><pre>public class MaxLengthValidator extends BaseValidator {

  private final int max;

  public MaxLengthValidator(final int max) {
    this(max, &quot;valid.maxLength&quot;);
  }

  public MaxLengthValidator(final int max, final String messageKey) {
    this.max = max;
    this.setMessageKey(messageKey);
  }

  // 検証メソッド、戻り値はエラーメッセージ。戻り値がnullなら検証エラーなし。
  public String validate(final ValidationContext ctx) {
    final Object value = ctx.getValue();
    if (value instanceof String) {
      String str = (String) value;
      if (StringUtil.isEmpty((String) value)) {
        return null;
      }
      if (str.length() &lt;= max) {
        return null;
      }
    } else if (value == null) {
      return null;
    }
    return getMessage(getPropertyMessage(ctx.getName()), max);
  }
}</pre></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2006-2007
    
          The Seasar Foundation and the others. All rights reserved.
          
  

  
    
  
  
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
