<html xmlns="http://www.w3.org/1999/xhtml" lang="ja" xml:lang="ja">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Cubbyドキュメント</title>
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta http-equiv="Content-Script-Type" content="text/JavaScript" />
  <link href="${contextPath}/default.css" rel="stylesheet" type="text/css" media="screen,projection" charset="utf-8" />
</head>
<body>
<h1>Cubbyドキュメント 2006-11-7</h1>
<h2>Cubbyって何？</h2>
<h2>特徴</h2>
<ul>
<li>JSPとJava5(Tiger)が分かれば簡単に使えます。</li>
<li>タグライブラリが直感的です。<br/>ex:&lt;t:input type="text" name="username"/&gt;</li>
<li>美しいURLが扱えます。<br/>ex:(ContextPath)/todo/list</li>
</ul>
<h2>ロードマップ</h2>
<h3>0.8(2006/11)</h3>
<ul>
<li>APIフィックス</li>
<li>Seasar Fundationへの申請</li>
</ul>
<h3>0.9(2006/12)</h3>
<ul>
<li>URLのマッピング機能<br/>ex:/todo/1 -&gt; /todo/show?id=1</li>
<li>その他足りない機能の実装</li>
<li>ドキュメントの充実</li>
</ul>
<h3>1.0(2007/1)</h3>
<ul>
<li>正式リリース版</li>
</ul>
<h2>コントローラーの仕様</h2>
<h3>コントローラーの基本的な使い方</h3>
<ul>
<li>１コントローラーにつき、複数のアクションメソッドを定義できます。</li>
<li>コントローラーはControllerクラスを継承して作成します。</li>
</ul>
<pre>
<code>
// コントローラクラスの@UrlでベースとなるURLを指定できます。
// 省略した場合、クラス名から「Controller」を除外して、
// １文字目をにしたものが使用されます。
// よって以下の@Urlは省略可能です。
@Url("todo")
public class TodoController extends Controller {

	// publicフィールドは自動的に、リクエストスコープのオブジェクトになります。
	// 以下のコードはreqest.setAttribute("todo", todo)と同様です。
	public Todo todo = new Todo();

	// @Sessionでセッションスコープのオブジェクトになります。
	// 以下のコードはsesstion.getAttribute("user")/setAttributeと同様です。
	@Session
	public User user;

	// アクションメソッドです。
	// アクションメソッドは、「戻り値がStringかつ引数がなし」のメソッドが対象になります。
	// @UrlでURLの残りの部分を指定します。
	// 省略した場合、メソッド名がしようされます。
	// このメソッドでは、「todo/show」がURLになります。
	@Url("show")
	public String show() {
		// paramsでリクエストパラエメータを直接取得することができます。
		todo = todoLogic.findById(params.toInt("id"));		
		
		// アクションメソッドの戻り値で遷移先を指定します。
		return "show.jsp";
	}

	// @Formでリクエストパラメータをバインディングするフォームオブジェクトのフィールド名を指定します。
	// 以下の例でたとえば、"memo"というパラメータは、todo.setMemoメソッドで自動的にでセットされます。
	@Form("todo")
	// @Validationをつけると、フォームオブジェクトに入力検証がかかります。
	// 検証エラー時はerrorPageに遷移します。
	@Validation(errorPage="edit.jsp")
	public String save() {
		todoLogic.save(todo);
		flash.put("notice", "TODOを追加しました。");
		// @マークを先頭につけると、リダイレクトして遷移します。
		return "@list";
	}
}
</code>
</pre>

<h3>コントローラーの基本的な使い方</h3>
<ul>
<li>アクションフィルターでアクションメソッド実行前・後の処理をフックできます。</li>
<li>Controller#initializeメソッドが、アクションメソッドの実行前に呼ばれます。</li>
<li>コントローラはJSP中では「controller」という変数で参照可能です。selectの一覧を取得するヘルパーメソッドを用意しておくと便利です。</li>
</ul>
<pre>
<code>
// @Filterで指定したアクションフィルターを
// アクションメソッド実行前にかけることができます。
@Filter({AuthActionFilter.class})
public class TodoController extends Controller {

	@Override
	public void initialize() {
		// 主に全アクションに共通的な表示用のデータを取得するために使用する
		// 入力検証エラーで戻るときにも呼ばれているので便利です。
	}

	// ----------------------------------------------[Helper Method]
	// selectの一覧を取得するヘルパーメソッド
	// JSPからは「contorller.todoTypes」で参照する。
	public List&lt;TodoType&gt; getTodoTypes() {
		return todoTypeLogic.findAll();
	}
}
</code>
</pre>

<h2>タグリファレンス</h2>
TODO
examplesのJSPを参考にしてください・・・・
<h2>Functionリファレンス</h2>
<div id="footer">
© Copyright The Seasar Foundation and the others 2006, all rights reserved.
</div><!-- End of id="footer" -->
</body>
</html>